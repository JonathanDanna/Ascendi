<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ghost Game</title>
</head>

<body>
    <div id="canvas">
        <canvas width="600" height="700"></canvas>
    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script style="text/javascript">
        var canvas = document.querySelector('canvas');
        var ctx = canvas.getContext('2d');

        var W = canvas.width;
        var H = canvas.height;

        var gameState = "start";

         //top scores
        var score1 = 0;
        var score2 = 0;
        var score3 = 0;
        var scoreCounter = 0;
        var scoreIncrement = 0.01;

        var bY = (H / 2);
        var bY2 = -48;
        var mY = 300;
        var delta = 0;
        var lastTime = (new Date()).getTime();
        var currentTime = 0;
        var speedCap = 700;

         // we draw the images onto the location of these variables.
        var floor1 = {
            x: 0,
            y: -50
        }
        var floor2 = {
            x: 0,
            y: -50
        }
        var floor3 = {
            x: 0,
            y: -50
        }
        var floor4 = {
            x: 0,
            y: -50
        }
        var floor5 = {
            x: 0,
            y: -50
        }
        var floor6 = {
            x: 0,
            y: -50
        }
        var floor7 = {
            x: 0,
            y: -50
        }
        var floor8 = {
            x: 0,
            y: -50
        }

         //seed the variables with a random number.
        var floorSwitcher = Math.floor(Math.random() * 5);
        var floorSwitcher2 = Math.floor(Math.random() * 5);

         // score
        score = 0;

         //object images
        var orangeWall = new Image();
        orangeWall.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/wall1.png';
        var redWall = new Image();
        redWall.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/wall2.png';
        var grayWall = new Image();
        grayWall.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/wall3.png';

        var floor1Image = new Image();
        floor1Image.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/beam1.png';
        var floor2Image = new Image();
        floor2Image.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/beam2.png';
        var floor3Image = new Image();
        floor3Image.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/beam3.png';
        var floor4Image = new Image();
        floor4Image.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/beam4.png';

        var ghostImage = new Image();
        ghostImage.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/Ghost.png';
        var vignette = new Image();
        vignette.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/vignette2.png';
        var startImage = new Image();
        startImage.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/StartButton.png';
        var chairImage = new Image();
        chairImage.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/chair.png';
        var gooImage = new Image();
        gooImage.src = 'http://thisiswhereiputmystuff.com/jonathan/GhostGame/ghostGoo.png';

         //empty objects, you draw an image on their position
        var ghost = {
            x: W / 2,
            y: H / 2,
        };

         //movement listeners
        var keysDown = {};
        window.addEventListener('keydown', function(e) {
            keysDown[e.keyCode] = true;
        });
        window.addEventListener('keyup', function(e) {
            delete keysDown[e.keyCode];
        });


        function update() {
            if (ghost.x < 0) {
                ghost.x = 0;
            }
            if (ghost.x + ghostImage.width >= canvas.width) {
                ghost.x = canvas.width - ghostImage.width;
            }
            if (ghost.y < 0) {
                ghost.y = 0;
            }
            if (ghost.y + (ghostImage.height / 2) >= canvas.height) {
                //this is where the lose scenario goes
                ghost.y = canvas.height - (ghostImage.height / 2);
                scoreCounter++;
                gameState = "lose";
                ghost.x = W / 2;
                ghost.y = H / 2;
                mY = 300;
                bY = (H / 2);
                bY2 = -48;
                score = 0;
            }
            if (gameState == "play") {
                score += scoreIncrement;
            }
        }

        function render() {

            currentTime = (new Date()).getTime();
            delta = (currentTime - lastTime) / 1000;

            if (gameState == "start") {
                var startButton = {
                    width: 100,
                    height: 50,
                    x: 100,
                    y: 480,
                }

                ctx.clearRect(0, 0, W, H);

                ctx.drawImage(startImage, startButton.x, startButton.y);
                ctx.drawImage(vignette, 0, 0);

                document.getElementById("canvas").addEventListener("click", function() {
                    gameState = "play";
                }, false);
            }

            if (gameState == "play") {
                ctx.clearRect(0, 0, W, H);
                ctx.fillRect(0, 0, 600, 700);

                //draw the vignette.
                ctx.drawImage(vignette, 0, 0);

                //draw the floors in a static location. floorX.y will be changed by the switches.
                ctx.drawImage(floor1Image, floor1.x, floor1.y);
                ctx.drawImage(floor2Image, floor2.x, floor2.y);
                ctx.drawImage(floor3Image, floor3.x, floor3.y);
                ctx.drawImage(floor4Image, floor4.x, floor4.y);
                ctx.drawImage(floor1Image, floor5.x, floor5.y);
                ctx.drawImage(floor2Image, floor6.x, floor6.y);
                ctx.drawImage(floor3Image, floor7.x, floor7.y);
                ctx.drawImage(floor4Image, floor8.x, floor8.y);

                //switches to change which floor is being used based on the random variables.
                switch (floorSwitcher) {
                    case 1:
                        floor1.y = bY;
                        break;
                    case 2:
                        floor2.y = bY;
                        break;
                    case 3:
                        floor3.y = bY;
                        break;
                    case 4:
                        floor4.y = bY;
                        break;
                    case 5:
                        floor1.y = bY;
                        break;
                }
                switch (floorSwitcher2) {
                    case 1:
                        floor5.y = bY2;
                        break;
                    case 2:
                        floor6.y = bY2;
                        break;
                    case 3:
                        floor7.y = bY2;
                        break;
                    case 4:
                        floor8.y = bY2;
                        break;
                    case 5:
                        floor5.y = bY2;
                        break;
                }

                //choose new random variables and reset the floor positions to the top.
                if (bY >= H) {
                    floorSwitcher = Math.floor(Math.random() * 5);
                    bY = -48;
                }
                if (bY2 >= H) {
                    floorSwitcher2 = Math.floor(Math.random() * 5);
                    bY2 = -48;
                }

                bY += (mY * delta);
                bY2 += (mY * delta);
                /*mY += (Math.floor(Math.round(score) * delta)) + .1;
                if (mY >= speedCap) {
                    mY = speedCap;
                }*/

                //drawing an image at the location of empty object "ghost"
                ctx.drawImage(ghostImage, ghost.x, ghost.y);

                //debugging text displays with fancy fonts
                ctx.font = '25pt Helvetica';
                ctx.fillStyle = '#000';
                ctx.fillText('bY: ' + Math.floor(Math.round(bY) / 100), (W / 4), 150);
                ctx.fillText('bY2: ' + Math.floor(Math.round(bY2) / 100), (W / 2), 150);
                ctx.fillText('score: ' + Math.round(score), (W / 8), 50);
                ctx.fillText('mY: ' + Math.floor(Math.round(mY)), (W / 2), 200);
                ctx.fillStyle = '#BAE5FF';


                //Ghost movements
                if (37 in keysDown) {
                    ghost.x -= (mY * delta) * 2;
                }
                if (38 in keysDown) {
                    if (((ghost.y < (floor1.y + 48) && (ghost.y > floor1.y) && (ghost.x > 145)) || (ghost.y < (floor5.y + 48) && (ghost.y > floor5.y)) && (ghost.x > 145)) || (((ghost.y < (floor2.y + 48) && (ghost.y > floor2.y)) && (ghost.x > 280)) || (ghost.y < (floor2.y + 48) && (ghost.y > floor2.y)) && (ghost.x < 144) || ((ghost.y < (floor6.y + 48) && (ghost.y > floor6.y)) && (ghost.x > 280)) || (ghost.y < (floor6.y + 48) && (ghost.y > floor6.y)) && (ghost.x < 144)) || (((ghost.y < (floor3.y + 48) && (ghost.y > floor3.y)) && (ghost.x > 446)) || (ghost.y < (floor3.y + 48) && (ghost.y > floor3.y)) && (ghost.x < 280) || ((ghost.y < (floor7.y + 48) && (ghost.y > floor7.y)) && (ghost.x > 446)) || (ghost.y < (floor7.y + 48) && (ghost.y > floor7.y)) && (ghost.x < 280)) || ((ghost.y < (floor4.y + 48) && (ghost.y > floor4.y) && (ghost.x < 446)) || (ghost.y < (floor8.y + 48) && (ghost.y > floor8.y)) && (ghost.x < 446)) ) {
                        ghost.y = ghost.y;
                        ctx.fillText("collided", 100, 100);
                    } else {
                        ghost.y -= (mY * delta) * 2;
                    }


                }
                if (39 in keysDown) {
                    ghost.x += (mY * delta) * 2;
                }
                if (40 in keysDown) {
                    ghost.y += (mY * delta) * 2;
                } else {
                    //default ghost velocity
                    ghost.y += (mY * delta);
                }




                lastTime = currentTime;
            }


            if (gameState == "lose") {
                ctx.clearRect(0, 0, W, H);
                ctx.fillStyle = '#BAE5FF';
                ctx.fillRect(0, 0, W, H);
                ctx.drawImage(grayWall, 0, ((orangeWall.height) + floor1Image.height));
                ctx.drawImage(floor1Image, 0, (orangeWall.height));
                ctx.drawImage(orangeWall, 0, 0);
                ctx.drawImage(vignette, 0, 0);


                if (scoreCounter == 1) {
                    score1 = Math.round(score);
                    newRound();
                }
                if (scoreCounter == 2) {
                    score2 = Math.round(score);
                    newRound();
                }
                if (scoreCounter == 3) {
                    score3 = Math.round(score);
                    newRound();
                }
                if (scoreCounter > 3) {
                    score1 = 0;
                    score2 = 0;
                    score3 = 0;
                    scoreCounter = 1;
                    newRound();
                }

                ctx.font = '25pt Helvetica';
                ctx.fillStyle = '#fff';
                ctx.fillText("Score 1:  " + Math.round(score1), (W / 3), 100);
                ctx.fillText("Score 2:  " + Math.round(score2), (W / 3), 200);
                ctx.fillText("Score 3:  " + Math.round(score3), (W / 3), 300);
            }
        }

        function newRound() {
            if (gameState != "play") {
                document.getElementById("canvas").addEventListener("click", function() {
                    gameState = "play";
                    ghost.x = W / 2;
                    ghost.y = H / 2;
                    score = 0;
                    mY = 300;
                }, false);
            }
        }


        function run() {
            update((Date.now() - time) / 1000);
            render((Date.now() - time) / 1000);
            time = Date.now();
        }

        var time = Date.now();
        setInterval(run, 10);
    </script>
</body>

</html>